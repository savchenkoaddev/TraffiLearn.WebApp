@model IEnumerable<TopicResponse>

<link rel="stylesheet" href="~/css/AllTopics.css" />

<div id="topics" class="container py-5 d-flex flex-column align-items-center">
    <div class="text-center mb-4 col-12">
        <h1 style="font-weight:700; font-size: 2.5rem; color: #343a40;">Список доступних тем</h1>
        <p style="font-size: 1.2rem; color: #6c757d;">Оберіть тему для початку тестування</p>
    </div>
    
    @foreach (var topic in Model)
    {
        <div id="topic-@topic.Id" class="topic-item shadow-sm col-10 col-md-8 col-lg-8 mb-3 d-flex align-items-center justify-content-between">
            <a href="~/topic/@topic.Id/questions" class="topic-link btn btn-light text-center flex-grow-1">
                <span style="font-size: 1.2rem;">
                    @topic.Number. @topic.Title
                </span>
            </a>

            

            <button class="btn delete-btn" style="color: red;" data-id="@topic.Id">
                <i class="bi bi-x-lg"></i>
            </button>

            <button class="btn edit-btn" style="color: dodgerblue;" data-id="@topic.Id" data-number="@topic.Number" data-title="@topic.Title">
                <i class="bi bi-pencil-square"></i>
            </button>

            <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editModalLabel">
                                Оновити дані теми
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form id="editForm">

                            <div class="modal-body">
                                <input type="hidden" id="topicId" name="id" />

                                <div class="mb-3">
                                    <label for="topicNumber" class="form-label">Введіть номер теми</label>
                                    <input type="number" class="form-control" id="topicNumber" name="Number" placeholder="Введіть номер теми" required min="0"/>
                                </div>

                                <div class="mb-3">
                                    <label for="topicTitle" class="form-label">Введіть назву теми</label>
                                    <input type="text" class="form-control" id="topicTitle" name="Title" placeholder="Введіть назву теми" required maxlength="300" />
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрити</button>
                                <button type="submit" class="btn btn-primary">Зберігти зміни</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    }
</div>
<!-- Include Bootstrap and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var deleteButtons = document.querySelectorAll(".delete-btn");
        deleteButtons.forEach(function (button) {
            button.addEventListener("click", function () {
                var topicId = this.getAttribute("data-id");

                if (confirm("Are you sure you want to delete this topic?")) {
                    fetch(`/topics/${topicId}`, {
                        method: "DELETE"
                    })
                        .then(response => {
                            if (response.ok) {
                                document.getElementById(`topic-${topicId}`).remove();
                            } else {
                                alert("Failed to delete the topic.");
                            }
                        })
                        .catch(error => {
                            console.error("Error:", error);
                            alert("Failed to delete the topic.");
                        });
                }
            });
        });

        var editButtons = document.querySelectorAll(".edit-btn");
        editButtons.forEach(function (button) {
            button.addEventListener("click", function () {
                var topicId = this.getAttribute("data-id");
                var topicNumber = this.getAttribute("data-number");
                var topicTitle = this.getAttribute("data-title");

                document.getElementById("topicId").value = topicId;
                document.getElementById("topicNumber").value = topicNumber;
                document.getElementById("topicTitle").value = topicTitle;

                var editModal = new bootstrap.Modal(document.getElementById("editModal"));
                editModal.show();
            });
        });

        var editForm = document.getElementById("editForm");
        editForm.addEventListener("submit", function (event) {
            event.preventDefault();

            var formData = new FormData(editForm);
            var id = formData.get("id");
            var number = formData.get("Number");
            var title = formData.get("Title");

            fetch(`/topics/${id}/update`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ number, title })
            })
                .then(response => {
                    if (response.ok) {
                        var editModal = bootstrap.Modal.getInstance(document.getElementById("editModal"));
                        editModal.hide();

                        location.reload();
                    } else {
                        alert("Failed to update the topic.");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("Failed to update the topic.");
                });
        });
    });

</script>